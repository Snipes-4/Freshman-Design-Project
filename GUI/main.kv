

#:set DECODE_COLOR "#7D2F5C"
#:set ENCODE_COLOR "#EA3033"
#:set LEARN_COLOR "#4A6C6F" 
#:set BUTTON_COLOR "#FFD700"
#:set BACKGROUND_COLOR "#32322C"
#:import Decoder decoder.Decoder

<MainScreenButton@Button>
    text_size: self.size
    font_size: 60
    size_hint:(.75, 1)
    pos_hint: {'center_x': .5, 'center_y': .5}
    valign: "middle"
    halign: "center"
    bold: "True"
    background_normal: ""
    
<MainScreen>
    BoxLayout:
        orientation: "vertical"
        padding: 50
        spacing: 30
        MainScreenButton:
            text: "Decode"
            background_color: DECODE_COLOR
            on_release:
                root.manager.current = "input"
                
        MainScreenButton:
            text: "Encode"
            background_color: ENCODE_COLOR
            on_release:
                root.manager.current = "encode"
        MainScreenButton:
            text: "Learn"
            background_color: LEARN_COLOR
            on_release:
                root.manager.current = "learn"
            
<BackArrow@Button>
    pos_hint: {"top":1, "left":1, "x":.005}
    size_hint: None, None
    size: 60,60
    background_color: (0,0,0,0)
    Image:
        source: "images/backarrow.png"
        pos: self.parent.pos
        size_hint: None, None
        size: self.parent.size
        
<EncodeScreen>
    encode_key_text_input: keyinput
    encode_message_text_input: userinput
    encoded_label: encodedmessage
    FloatLayout:
        BackArrow:
            on_release: root.manager.current = "main"
        TextInput:
            id: userinput
            focus: True
            hint_text: "Input message"
            size_hint: .4, .2
            size: self.parent.x, self.parent.y
            pos_hint: {"bottom":1, "left":1}
            padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
            font_size: 25
            halign: "center"
            multiline:False
        Label:
            text: "User Input"
            size_hint: userinput.size_hint
            font_size: userinput.font_size
            pos: userinput.x, userinput.y+100
        TextInput:
            id: keyinput
            hint_text: "Input cipher key"
            size_hint: .4, .2
            size: self.parent.x, self.parent.y
            pos_hint: {"bottom":1, "right":1}
            padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
            font_size: 25
            halign: "center"
            focus: False
        Label:
            text: "Encoding Key"
            size_hint: userinput.size_hint
            font_size: userinput.font_size
            pos: keyinput.x, keyinput.y+100
        Button:
            text: "Submit"
            size_hint: .2, .2
            size: self.parent.x, self.parent.y
            pos_hint: {"center_x":.5, "bottom":1}
            font_size: 25
            background_color: BUTTON_COLOR
            on_release: root.encode_message(userinput.text, keyinput.text)
        Label:
            id: encodedmessage
            size_hint_y: None
            text_size: self.width, None
            font_size: 40
            height: self.texture_size[1]
            pos_hint: {"center_y":.6}
            padding_x: 30
            
            
<InputScreen>
    FloatLayout:
        BackArrow:
            on_release: root.manager.current = "main"
        GridLayout:
            rows:2
            rows_minimum: {0: 50, 1: 20}
            Label:
                text: "Would you like to decode with or without a key?"
                pos_hint: {'center_x':.5}
                size_hint_y: None
                font_size: 30
                height: self.texture_size[1] + 30
            GridLayout:
                cols:2
                Button:
                    text:"With Key"
                    background_color: BUTTON_COLOR
                    size_hint: 0.2,0.3
                    on_release: root.manager.current = "withkey"
                Button:
                    text:"Without Key"
                    background_color: BUTTON_COLOR
                    size_hint: 0.2,0.3
                    on_release: root.manager.current = "withoutkey"
<WithKeyScreen>
    message_text_input: usermessageinput
    key_text_input: userkeyinput
    FloatLayout:                
        BackArrow:  
            on_release: root.manager.current = "input"
        GridLayout:
            rows:4 
            rows_minimum: {0: 50, 1: 20, 2: 20, 3: 20}
            Label:
                text: "Enter message and the key for the message."
                size_hint_y: None
                height: self.texture_size[1] + 30
                font_size: 30
                pos_hint: {"center_x":.5}
                padding_x: 30
            TextInput:
                id: usermessageinput
                focus: True
                hint_text: "Input message"
                size_hint: .4, .2
                size: self.parent.x, self.parent.y
                pos_hint: {"bottom":1, "left":1}
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                font_size: 25
                halign: "center"
                multiline:True
            TextInput:
                id: userkeyinput
                focus: True
                hint_text: "Input key"
                size_hint: .4, .2
                size: self.parent.x, self.parent.y
                pos_hint: {"bottom":1, "left":1}
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                font_size: 25
                halign: "center"
                multiline:True
            Button:
                text:"Submit"
                background_color: BUTTON_COLOR
                size_hint: 0.2,0.3
                on_release: 
                    root.manager.current = "decode" 
                    root.submit_messageandkey()          
<WithoutKeyScreen>
    message_text_input: usermessageinput
    FloatLayout:                
        BackArrow:  
            on_release: root.manager.current = "input"
        GridLayout:
            rows:3
            rows_minimum: {0: 50, 1: 20, 2: 20}
            Label:
                text: "Enter the message."
                size_hint_y: None
                font_size: 30
                height: self.texture_size[1] + 30
                pos_hint: {"center_x":.5}
            TextInput:
                id: usermessageinput
                focus: True
                hint_text: "Input message"
                size_hint: .4, .2
                size: self.parent.x, self.parent.y
                pos_hint: {"bottom":1, "left":1}
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                font_size: 25
                halign: "center"
                multiline:True
            Button:
                text:"Submit"
                background_color: BUTTON_COLOR
                size_hint: 0.2,0.3
                on_release: 
                    root.manager.current = "decode" 
                    root.submit_message()

            
<DecodeScreen>
    edited_message_label: edited_message
    original_message_label: original_message
    frequency_label : frequency_chart
    on_enter: ()
    FloatLayout:
        BackArrow:
            on_release: root.manager.current = "main"
        GridLayout:
            rows:3
            rows_minimum: {0: 20, 1: 20, 2: 50}
            Label:
                id: edited_message
                text:"this message changes"
                size_hint_y: .3
                text_size: self.size
            Label:
                id: original_message
                text:"this message stays the same"
                color: BUTTON_COLOR
                size_hint_y: .3
                text_size: self.size
                
            GridLayout: 
                cols:3
                GridLayout:
                    rows:2
                    TextInput:
                        id: select_letter
                        hint_text: "Selected Letter"
                    TextInput:
                        id: new_letter
                        hint_text: "Replace with"
                GridLayout:
                    rows:3
                    Button:
                        text:"Clear"
                        background_color: BUTTON_COLOR
                        on_release:
                            root.clear_message()
                    Button:
                        text:"Undo"
                        background_color: BUTTON_COLOR
                        on_release:
                            root.undo_letter(select_letter.text)
                    Button:
                        text:"Replace"
                        background_color: BUTTON_COLOR
                        on_release:
                            root.replace_letter(new_letter.text,select_letter.text)
                Label:
                    id: frequency_chart
                    font_size: '15sp'
                    outline_color: 0, 0, 0
                    outline_width: 1
                    text_size: self.size
                    text: 'frequency'
                    

<LearnScreen>
    Carousel:
        id: carousel
        # SLIDE 1
        FloatLayout:
            Label:
                pos_x: -20
                pos_hint: {"center_y": .83}
                text: "What is cryptography and what are ciphers?"
                font_size: '35'
                bold: True
            Label:
                text:"Cryptography, at its most basic level, is the practice and study of manipulating messages and information to make communication more secure and private. It is a field that pervades many others, such as mathematics and computer science."
                pos: (10, 50)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
            Label:
                text:"Ciphers are a particular form of cryptography, in which messages have their letters and words shifted and changed to make them difficult or impossible to understand without a key, a piece of information that allows someone to decode the cipher text. Examples of very basic ciphers are the Caesar cipher and the substitution cipher."
                pos: (10, -100)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
        # SLIDE 2
        FloatLayout:
            Label:
                id: title2
                pos_x: -20
                pos_hint: {"center_y": .86}
                text: "History of cryptography"
                font_size: '35'
                bold: True
            Label:
                text:"Cryptography as a practice has existed for thousands of years. The earliest known use of cryptography was around 1900 BCE in Egypt, and many other historical civilizations are known to have used cryptography, such as the Greeks and Romans."
                pos: (10, title2.y-100)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
            Label:
                text:"One of the most significant discoveries in the history of cryptography was the discovery of frequency analysis, which is a process that measures the frequency of characters or groups of characters to aid in the decoding of cipher text."
                pos: (10, 0)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
            Label:
                text:"The development of frequency analysis made making secured messages nearly impossible until the development of polyalphabetic cipher, a cipher that utilizes many different substitution alphabets to encode messages."
                pos: (10, -100)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
            Label:
                text:"Ultimately, modern cryptography is done using the assumption that a system of ciphers itself is not secure enough, and that the protection of a message’s key was the best form of protection and security in the modern age."
                pos: (10, -190)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
        # SLIDE 3
        FloatLayout:
            Label:
                id: title3
                pos_x: -20
                pos_hint: {"center_y": .86}
                text: "Caesar ciphers"
                font_size: '35'
                bold: True
            Label:
                text:"Caesar ciphers are used by shifting the alphabet of a message by a set amount to encode the message. For example, for a Caesar cipher with a shift of 4, every instance of the letter ‘A’ would become the letter ‘E’, every instance of the letter ‘B’ would become the letter ‘F’, and so on for the entire alphabet, wrapping the alphabet around when shifting past the end."
                pos: (10, title3.y-100)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
            Label:
                id: staticletters
                pos: (0, title3.y-200)
                size: self.texture_size
                Image:
                    source: "images/staticletters.png"
                    pos: self.parent.pos
                    size_hint: None, None
                    size: self.parent.size
            Label:
                id: shiftedletters
                pos: (0, staticletters.y-50)
                size: self.texture_size
                Image:
                    source: "images/caesarshiftletters.png"
                    pos: self.parent.pos
                    size_hint: None, None
                    size: self.parent.size
            Label:
                text:"SECRET MESSAGE --> WIGVIX QIWWEKI"
                pos: (100, shiftedletters.y-85)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '30'
                bold: True
            Label:
                text:"This type of cipher seems fairly basic, and indeed is very easy to crack with modern methods and technology, but like many early forms of cryptography, Caesar ciphers and other early ciphers and their derivatives were necessary for the development of further cryptographic ideas and techniques."
                pos: (10, shiftedletters.y-190)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
        # SLIDE 4
        FloatLayout:
            Label:
                id: title3
                pos_x: -20
                pos_hint: {"center_y": .86}
                text: "Basic substitution ciphers"
                font_size: '35'
                bold: True
            Label:
                text:"The basic substitution cipher is very similar to the Caesar cipher, with the difference being that instead of shifting the cipher alphabet a set amount, each letter is instead set to equal another letter at random, with each letter of the original alphabet being assigned to a unique letter of the cipher alphabet. "
                pos: (10, title3.y-100)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
            Label:
                id: staticletters
                pos: (0, title3.y-200)
                size: self.texture_size
                Image:
                    source: "images/staticletters.png"
                    pos: self.parent.pos
                    size_hint: None, None
                    size: self.parent.size
            Label:
                id: shiftedletters
                pos: (0, staticletters.y-50)
                size: self.texture_size
                Image:
                    source: "images/basicsubletters.png"
                    pos: self.parent.pos
                    size_hint: None, None
                    size: self.parent.size
            Label:
                text:"SECRET MESSAGE --> KSDXSG NSKKCDS"
                pos: (90, shiftedletters.y-85)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '30'
                bold: True
            Label:
                text:"Again, like Caesar ciphers, substitution ciphers seem fairly simplistic and easy to crack with modern techniques and knowledge, which most indeed are, especially with the advent of frequency analysis. But also like Caesar ciphers, substitution ciphers were very important to the history and development of early cryptography. The fundamental idea of substitution is still used in modern ciphers to this day."
                pos: (10, shiftedletters.y-190)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
        # SLIDE 5
        FloatLayout:
            Label:
                id: title5
                pos_x: -20
                pos_hint: {"center_y": .86}
                text: "Encoding substitution ciphers"
                font_size: '35'
                bold: True
            Label:
                text:"Encoding a message using a substitution cipher is fairly straightforward. To do so with just a pencil and paper, you should first write down the entire alphabet that you are using."
                pos: (10, title5.y-100)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
            Label:
                pos: (0, title5.y-170)
                size: self.texture_size
                Image:
                    source: "images/staticletters.png"
                    pos: self.parent.pos
                    size_hint: None, None
                    size: self.parent.size
            Label:
                text:"Then, one by one go through each letter and choose a random letter from the alphabet that you have not used previously to replace it with."
                pos: (10, title5.y-240)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
            Label:
                pos: (0, -90)
                size: self.texture_size
                Image:
                    source: "images/basicsubletters.png"
                    pos: self.parent.pos
                    size_hint: None, None
                    size: self.parent.size
            Label:
                text:"Once you have done so, you can simply use the cipher pair of alphabets to write out the message. Many modern programs can be created and used to do this process quickly, but at their fundamental level, electronic substitution ciphers work the same as physical ones, subbing out every letter of the alphabet for a random and unique letter on the cipher alphabet."
                pos: (10, shiftedletters.y-170)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
        # SLIDE 6
        FloatLayout:
            Label:
                id: title6
                pos_x: -20
                pos_hint: {"center_y": .86}
                text: "Decoding substitution ciphers"
                font_size: '35'
                bold: True
            Label:
                text:"The most straightforward way of decoding a ciphered message is to use the key to solve it. However, in lieu of a key, the most common way of solving a substitution cipher is to use a previously discussed technique: frequency analysis. The basic premise of frequency analysis is noting the frequency of letters in a cipher and replacing them with letters of equivalent frequency in the corresponding alphabet."
                pos: (10, title6.y-100)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
            Label:
                pos: (325, title6.y-20)
                size: 40, 20
                Image:
                    source: "images/letterfreq.png"
                    pos: self.parent.pos
                    size: 150, 150
            Label:
                text:"For example, the most frequently used letter in the English alphabet is the letter ‘E’. So if the letter ‘K’ is the most frequent letter in our cipher, we can assume that the original letter that ‘K’ was substituted for was the letter ‘E’."
                pos: (10, title6.y-370)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
            Label:
                text:"This process can be repeated for the other letters of the alphabet, using predefined frequencies to compare the cipher text’s letter frequency to."
                pos: (10, title6.y-450)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '19'
        # SLIDE 7
        FloatLayout:
            Label:
                id: title7
                pos_x: -20
                pos_hint: {"center_y": .86}
                text: "Making substitution ciphers stronger"
                font_size: '35'
                bold: True
            Label:
                text:"Substitution ciphers, in modern times with modern techniques and technology, are fairly weak. So how would one make them stronger?"
                pos: (10, title7.y-90)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
            Label:
                text:"One of the common solutions to making a substitution cipher stronger is encoding a message multiple times with varying alphabets. For example, a message may be encoding using the substitution method discussed earlier, and then the new message may be encoded once again, using a new cipher alphabet. "
                pos: (10, 0)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
            Label:
                text:"Another solution is to expand the ‘alphabet’ used when encoding. For example, rather than replacing single letters with other letters, you could replace pairs of letters with other pairs, such as the pair ‘EE’ being replaced with ‘TR’, or the pair ‘AB’ being replaced with ‘YH’. This expands the complexity of the cipher."
                pos: (10, -130)
                text_size: root.width-90, None
                size: self.texture_size
                font_size: '20'
    FloatLayout:
        BackArrow:
            on_release: root.manager.current = "main"
